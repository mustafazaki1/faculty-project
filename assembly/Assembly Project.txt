Include irvine16.inc

FileControlBlock struc
db 22 dup(?) ; header info 
fileTime dw ? ; time stamp of file
fileDate dw ? ; date stamp of file
fileSize dd ? ; size of file
fileName db 13 dup(0) ; name of file found by DOS
FileControlBlock ends

.data
filespec db "C:\N\*.txt",0
DTA FileControlBlock <>
filehandle dw ?
bufferSize = 512
namefile db 13 DUP(?),0
buffer db bufferSize dup(0)

.code
main PROC
mov ax,@data ; initialize DS
mov ds,ax
mov ah,1Ah ; set transfer address
mov dx,offset DTA
int 21h

mov ah,4Eh ; find first matching file
mov cx,1
mov dx,offset filespec
int 21h


mov di,offset filespec
mov si,offset namefile

Copy:
cmp byte ptr [di],"*"
je break
mov ax,[di]
mov [si],ax
inc di
inc si
JMP Copy
break:

mov cx,lengthof DTA.fileName
mov di,offset DTA.fileName

Copy2:
mov ax,[di]
mov [si],ax
inc di
inc si
LOOP Copy2

mov ah,3Dh ;  open file
mov al,0 ; choose the input mode
mov dx,offset namefile
int 21h ; call DOS

mov filehandle,ax ; no error: save the handle

mov ah,3Fh ; read from file or device
mov bx,filehandle ; BX = file handle
mov cx,buffersize; number of bytes to read
mov dx,offset buffer ; point to buffer
int 21h ; read the data

call writestring

call DUMPREGS
.EXIT 
main ENDP
END main